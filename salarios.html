<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Cuanto cobran los concejales de AM y a que destinan la reducción de su salario">
     <meta name="author" content="Ahora Madrid">
    <link rel="icon" href="favicon.ico">

    <title>Salarios Concejales | Ahora Madrid</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:700' rel='stylesheet' type='text/css'>
    

    <!-- Table Sorter -->
    <link rel="stylesheet" href="js/themes/blue/style.css" type="text/css" id="" media="print, projection, screen" />
<link href="css/tablas.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
      <script src="js/iframeResizer.contentWindow.min.js"></script>
  </head>


<body>

    <div class="container">
    
    <!-- intro -->
    <div class="row" id="intro">
    <div class="col-md-12 noPadding">
    <ol class="breadcrumb">
      <li><a href="http://ahoramadrid.org/">ahora madrid</a></li>
      <li><a href="index.html">transparencia</a></li>
      <li class="active">concejales</li>
    
    </ol> 
    <hr/>
    
    </div>
    </div>
    
    
    
    <!-- cabecera -->
     <div class="row" id="cabecera">
     
     <div class="col-md-7 nopaddingL">
     <h2>Salarios Concejales</h2>
     </div>
     
     <div class="col-md-5 text-right noPadding">
      <select id="jump_menu"></select>
    </div>
     </div>
    
    
    
    <div class="row">
    
    <div class="col-md-7 nopaddingL">
    
     <hr/>

    <p >Concejales y personal eventual tienen un salario bruto oficial, estipulado por el pleno del ayuntamiento.</p>
    <p class="bigger">El Reglamento económico de Ahora Madrid establece que el salario que efectivamente se cobre sea de <strong>cuatro salarios mínimos brutos</strong>.</p>
    <p>Las diferencias entre las donaciones de cada persona están relacionadas con las excepciones establecidas en el Reglamento Económico: hijos e hijas, dependientes a cargo, etc.</p>
	
    
     
    </div>
    
    <div class="col-md-5 text-right nopaddingR">
        <hr/>
     <p><small>Esta información se renueva trimestralmente.</small></p>
   <p><em>última actualización: 10 de marzo 2016</em></p>
   
   <hr/>
   
   <p><a href="pdf/Reglamento_economico_cargos_electos_AM.pdf"><i class="fa fa-download" style="padding-right: 1em;"></i> <small>Reglamento económico cargos electos</small></a></p>

    </div>
    </div>
    
    <div class="row">
    <div class="col-md-12 nopaddingL">
    <p>Además, según estipula la Ley Reguladora de las Bases de Régimen Local, el ayuntamiento solo puede tener 45 concejales a tiempo completo. El grupo de Ahora Madrid ha asumido que cuatro de sus miembros (en este momento Montse Galcerán, Mauricio Valiente, Carlos Sánchez Mato y Pablo Carmona, pero van a ir rotando cada año) asuman ese tipo de contratación temporal y, por tanto, su retribución es también menor.</p>
    </div>
    </div>
        
     <div class="row">
     <div class="col-md-4 nopaddingL" id="donut"></div>
     <div class="col-md-8 nopaddingR separaTop6">
     
      <div class="row">
      <div class="col-md-2"><h3 id="d1" class="por100 grigio">30 %</h3></div>
      <div class="col-md-10"><p class="separaTop">Reducción media de salario.</p></div>
      </div>
      
      <div class="row">
      <div class="col-md-2"></div>
      <div class="col-md-10"><p class="separaTop">
      <strong class="grigio">Esta reducción se dedica a donaciones:
      </strong><br/>Financiación de proyectos de innovación social abierta en <a href="http://goteo.org" target="_blank">goteo.org</a><br/>
      y Donación libre <small> (puedes ver los destinatarios en la página de cada concejal)</small>
      </p></div>
      </div>
            
      
     </div>
     </div>
    
    <div class="row">
    <div class="col-md-12 noPadding">
    <hr/>
   
   <ul class="nav nav-pills">
     <li role="presentation" class="active">
       <a href="#periodo-0"> 1 Jul 2015 - 31 Dic 2015</a>
     </li>          
   </ul>
   
    
    <table id="salarios_meses" class="table tablesorter"> 
    <thead> 
    
    <tr> 
        <th>mes</th> 
        <th>salario nominal</th> 
        <th>salario percibido</th> 
        <th>goteo</th>
        <th>donaciones</th>
     </tr> 
     
    </thead> 
    <tbody></tbody> 
    </table> 
    
       <p class="grigio" style="margin-top: 1.5em;"><small>* La legislatura de 2015 comenzó el 15 Junio.</small></p>
       
       <p>En la página de cada concejal puedes conocer los detalles de sus ingresos y los destinatarios de las donaciones.
       </p>
       
    
    </div>
    </div>
    
     
       
    
    <div class="row separaMas">
     <div class="col-md-12 noPadding" id="concejales"></div>
     
     <!--
     <div class="col-md-12 noPadding">
      <hr/>
     
      <h4>eventuales</h4>
      <p>Los trabajadores eventuales contratados también tienen una limitación salarial. 
        <br/>
        <a class="btn btn-success" href="eventual.html"> Consultar sección de eventuales</a>
      </p>
      
      
      
    </div>
     -->
    </div>
    
       
    
    </div> <!-- end container -->
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
     <script src="js/jquery.min.js"></script>
     <!-- Include all compiled plugins (below), or include individual files as needed -->
     <script src="js/bootstrap.min.js"></script>
     
     <!-- CSV parse -->
     <script src="js/papaparse.min.js"></script>
     <!-- formatCurrency -->
     <script src="js/jquery.formatCurrency-1.4.0.pack.js"></script>
      <!-- formatDate -->
      <script src="js/moment-with-locales.js"></script>
     
     <!-- tablesorter -->
     <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script> 
     
     <!-- highcharts.js -->
     <script src="https://code.highcharts.com/highcharts.js"></script>
     <script type="text/javascript" src="https://code.highcharts.com/modules/data.js"></script>
     
     <!-- isotope -->
     <script src="js/isotope.pkgd.js"></script>
     <script src="js/packery-mode.pkgd.min.js"></script>
     
      <!-- cookies -->
     <script src="js/js.cookie.js"></script>
     <script src="js/salarios_common.js"></script>
     <script src="js/jump_menu_transparencia.js"></script>
     
     <script>
     
     // jump menu
     $(document).ready(function() { 
     	var myPage = "salarios.html";
     	$("#jump_menu").find("option[value='" + myPage +"']").attr('selected', true);
      }); 
     
     
      
     var totC = {nominal:0.0, percibido:0.0, goteo:0.0, donacion:0.0, c:0.0, e:0.0};
     moment.locale('es');  // translate dates to es format
     
     var donutData = []; // donut graph data
    
    var infoConcejales;
     
     $(document).ready(function() { 
        $.getJSON( "datos_03/concejal.json", function( data ) {
                infoConcejales=data.concejales  
                parseCSV();     
           
            });

	
	console.log("fin document ready");
    }); //end document ready 
     
  function parseCSV(){
        Papa.parse("datos_03/salarios.csv", {
        download: true,
        header: true,
        delimiter: "\t",    
        complete: function(results) {
            console.log("parsed");
             //console.log(results.data);
            resultados=results
            var meses = []; // todos MM_AAAA
            var mesesR = []; // rótulos MM, AAAA
            var mesesL = []; // labels
            
            var peopleID = []; // just ID // once
            var peopleIDRow = []; // just ID
            var peopleData = []; // data Objects // once
            var peopleDataRow = []; // data Objects
            
            $.each( results.data, function( index, value ) {

                 var obj = value;
                 if( ("fecha" in obj)==false || ("id" in obj) == false || ("nombre" in obj) == false  || ("apellidos" in obj)== false) return true;
                 var miMes = moment(obj.fecha, "DD/MM/YYYY").format("MMMM");
                 var miAnno = moment(obj.fecha, "DD/MM/YYYY").format("YYYY");
                 var mes_anno = miMes +"_" + miAnno;
                 var mesYanno = miMes +", " + miAnno;
                 meses.push(mes_anno);
                 mesesR.push(mesYanno);
                 //console.log(miFecha);
                 peopleIDRow.push(obj.id); 
                 // people data
                 // create new object > add to array
                 peopleDataRow[obj.id] = {nombre: obj.nombre, apellidos: obj.apellidos, status: obj.status, nominal: 0.0, percibido: 0.0, goteo: 0.0, donaciones: 0.0};
            }); 
            
            //console.log(peopleID);
            // unique ID
            
            // var uniqueNames = [];
            $.each(peopleIDRow, function(i, el){
                if($.inArray(el, peopleID) === -1){
                 peopleID.push(el);
                }
            });
            
            for (i = 0; i < peopleID.length; i++) { 
                //console.log(peopleID[i]);
                var ID = peopleID[i];
                var P = peopleDataRow[ID];
                peopleData[ID] = P;
            }
            
            //console.log(peopleData);
                        
            var peopleIDRow = []; // clean up
            var peopleDataRow = [];
                    
            // unique month
            var thisM = meses[0];
            mesesL.push(thisM);
            
            var mesesTot = {};
            //mesesTot[thisM] = 0.0;
            
            mesesTot[thisM] = {nominal: 0.0, percibido: 0.0, goteo: 0.0, donaciones: 0.0};
    
            var mesesRot = []; 
            mesesRot.push(mesesR[0]);
            
            for (i = 0; i < meses.length -1; i++) { 
                var nextM = meses[i+1];
                
                if(thisM == nextM){
                // nothing
                } else {
                    thisM = nextM;
                    mesesL.push(thisM);
                    mesesTot[thisM] = {nominal: 0.0, percibido: 0.0, goteo: 0.0, donaciones: 0.0};
                    mesesRot.push(mesesR[i+1]);
                }
            }

        $.each( results.data, function( index, value ) {
             var obj = value;
             if( ("fecha" in obj)==false || ("id" in obj) == false || ("nombre" in obj) == false  || ("apellidos" in obj)== false) return true;
             // tot by month
             var miMMMM = moment(obj.fecha, "DD/MM/YYYY").format("MMMM");
             var miAAAA = moment(obj.fecha, "DD/MM/YYYY").format("YYYY");
             var miMM_AAAA = miMMMM + "_" + miAAAA;
             
             // tot by people
             peopleData[obj.id].nominal += Number(obj.s_nominal);
             peopleData[obj.id].percibido += Number(obj.s_percibido);
             peopleData[obj.id].goteo += Number(obj.goteo);

             mesesTot[miMM_AAAA].nominal += Number(obj.s_nominal);
             mesesTot[miMM_AAAA].percibido += Number(obj.s_percibido);
             mesesTot[miMM_AAAA].goteo += Number(obj.goteo);

             totC['nominal'] += Number(obj.s_nominal);
             totC['percibido'] += Number(obj.s_percibido);
             totC['goteo'] += Number(obj.goteo);
             totC[obj.status] += Number(obj.s_percibido);

             for (i = 1; i <= 8; i++) { 
               if (obj['donacion_'+i]) {
                 peopleData[obj.id].donaciones += Number(obj['donacion_'+i]);
                 mesesTot[miMM_AAAA].donaciones += Number(obj['donacion_'+i]);
                 totC['donacion'] += Number(obj['donacion_'+i]);
               }
             }
        }); 
        
        // table > monts
        var myTable =  $("#salarios_meses > tbody");
        for (i = 0; i < mesesL.length; i++) { 
            var thisM = mesesL[i];
            
            var myRow = "<tr>";
            myRow += "<td>" + mesesRot[i] + "</td>" ; // mes, año
            myRow += "<td class='money'>" + mesesTot[thisM].nominal + "</td>" ;
            myRow += "<td class='money'>" + mesesTot[thisM].percibido + "</td>" ;
            myRow += "<td class='money'>" + mesesTot[thisM].goteo + "</td>" ;
            myRow += "<td class='money'>" + mesesTot[thisM].donaciones + "</td>" ;
                        
            $(myTable).append( myRow);
        }
        
        // write total(s)
        $("#totalG .bg_tot p.importe").text(totC['nominal']);
        $("#partes .bg_t1 p.importe").text(totC['c']);
        $("#partes .bg_t2 p.importe").text(totC['e']);
        $("#partes .bg_t3 p.importe").text(totC['goteo']);
        $("#partes .bg_t4 p.importe").text(totC['donacion']);
        
        // calculate width
        var t1W = totC['c'] * 100.00 / totC['nominal'];
        var t2W = totC['e'] * 100.00 / totC['nominal'];
        var t3W = totC['goteo'] * 100.00 / totC['nominal'];
        var t4W = totC['donacion'] * 100.00 / totC['nominal'];
        var t0W = totC['percibido'] * 100.00 / totC['nominal'];
        
        // donut data
        donutData.push(["Salarios neto limitado", 70]);
        donutData.push(["Apoyo a proyectos vía Goteo", 15]);
        donutData.push(["Donaciones", 15 ]);
        
        // update % texts
       // $('#d1').text(t0W.toFixed(1) + '%');
        //$('#d2').text(t3W.toFixed(1) + '%');
        //$('#d3').text(t4W.toFixed(1) + '%');
        
        // assign width
        $('#partes .bg_t1').css({width: t1W.toFixed(4) + '%'});
        $('#partes .bg_t2').css({width: t2W.toFixed(4) + '%'});
        $('#partes .bg_t3').css({width: t3W.toFixed(4) + '%'});
        $('#partes .bg_t4').css({width: t4W.toFixed(4) + '%'});        
        
        // cards concejales / table eventuales
        var myTable =  $("#salarios_eventuales > tbody");             
        generateCards(peopleID, peopleData, infoConcejales);
        window.setTimeout(initC, 500); //ñaaaapa. Si no hay un poco de retraso a veces no ejecuta la funcion de cards
        } // end complete loading json
        
     }); // end pepa parse

}   
     
    var initC=function() {
     console.log("init");
    
    $('.money').formatCurrency({
            decimalSymbol: ',',
            digitGroupSymbol: '.',
            symbol: '€',
            positiveFormat: '%n <span class="euro">%s</span>',
            roundToDecimalPlace:-2
    });
         
    $("#salarios_meses").tablesorter({ 
             // sort on the first column and third column, order asc 
              sortList: [[0,0]] 
         }); 
     
     $("#salarios_eventuales").tablesorter({ 
             // sort on the first column and third column, order asc 
              // sortList: [[0,0]] 
        });     
      
      // isotope
      var $grid = $('#concejales').isotope({
        // options
        itemSelector: '.card',
        // layoutMode: 'fitRows',
        layoutMode: 'packery',
        packery: {
          gutter: 8
        }         
      });
      
      $( ".card" ).click(function() {
        var c = $(this ).data( "id" ); // 52
        Cookies.set('concejal', c, { expires: 7, path: '' });
        window.location.href = "concejal.html";
        // alert( "Handler for " + c);
      }); 
      
      //$(function () {
      
      Highcharts.setOptions({
              colors: ['#00a58d', '#4d4d4d', '#999999', '#e95026', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4']
          });
          
          
          $('#donut').highcharts({
              chart: {
                  plotBackgroundColor: null,
                  plotBorderWidth: 0,
                  plotShadow: false
              },
              
              title: {
                  text: ' ',
                  align: 'center',
                  verticalAlign: 'middle'
                  //y: 40
              },
              
              tooltip: {
                  //pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                  pointFormat: '{series.name}'
              },
              
              plotOptions: {
                  pie: {
                      dataLabels: {
                          enabled: false,
                          distance: -50,
                          style: {
                              fontWeight: 'bold',
                              color: 'white',
                              textShadow: '0px 1px 2px black'
                          }
                      },
                     // startAngle: -90,
                     // endAngle: 90,
                      center: ['50%', '50%']
                  }
              },
              
              series: [{
                  type: 'pie',
                  name: 'distribución salario bruto',
                  innerSize: '50%',
                  data: donutData
                  }]
          });
      //});      
    }     
     
     
               
    </script>
</body>

</html>
